---
groups:
  - name: container
    rules:
    - alert: ContainerHighCPU
      expr: sum(rate(container_cpu_usage_seconds_total{name=~".+"}[5m])) by (name, instance) > 0.8
      for: 5m
      labels:
	service: container
	severity: warning
      annotations:
	description: CPU usage of container {{ $labels.name }} on {{ $labels.instance }} is high

    - alert: ContainerExtremelyHighCPU
      expr: sum(rate(container_cpu_usage_seconds_total{name=~".+"}[5m])) by (name, instance) > 0.95
      for: 5m
      labels:
	service: container
	severity: critical
      annotations:
	description: CPU usage of container {{ $labels.name }} on {{ $labels.instance }} is extremely high

    - alert: ContainerHighMemory
      expr: sum(container_memory_rss) by (instance, name) > 1200000000
      for: 5m
      labels:
	service: container
	severity: warning
      annotations:
	description: Memory usage of container {{ $labels.name }} on {{ $labels.instance }} is high

    - alert: ContainerStopped
      expr: sum(time() - container_last_seen) by (name, instance) > 60 * 5
      labels:
	service: container
	severity: warning
      annotations:
	description: Container {{ $labels.name }} on {{ $labels.instance }} stopped
